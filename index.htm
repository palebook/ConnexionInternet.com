<!doctype html>
<html lang="fr">
<head>
  <link rel="icon" type="image/png" href="https://i.postimg.cc/1XM0nq03/145219762.png" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Connexion à Internet</title>
  <style>
    :root{font-family:"Tahoma",sans-serif;margin:0}
    body{background:#008080 url('') repeat;font-size:14px;padding:40px;display:flex;justify-content:center}
    .card{width:100%;height:100vh;background:#c0c0c0;border:2px solid #ffffff;border-right-color:#404040;border-bottom-color:#404040;border-radius:0;padding:0;box-shadow:none;display:flex;flex-direction:column}
    h1{background:#000080;color:white;padding:6px 8px;font-size:16px;margin:0;font-weight:bold}
    p.lead{padding:8px;background:#dcdcdc;margin:0;color:#000}

    /* zones internes */
    #start,#form-wrap,.list,.footer{padding:12px 16px;background:#c0c0c0}

    button{cursor:pointer;padding:4px 8px;border:2px solid #fff;border-right-color:#404040;border-bottom-color:#404040;background:#e0e0e0;color:#000;font-size:13px}
    button:active{border:2px solid #404040;border-right-color:#fff;border-bottom-color:#fff}

    input[type=text],input[type=password],input[type=tel]{width:100%;padding:3px;border:2px solid #fff;border-right-color:#404040;border-bottom-color:#404040;background:#fff;font-size:13px}

    label{font-size:13px;margin-bottom:4px;display:block;color:#000}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    .item{padding:10px;background:#dcdcdc;border:2px solid #fff;border-right-color:#404040;border-bottom-color:#404040;margin-bottom:10px}
    .meta{font-weight:bold}
    .small{font-size:12px;color:#000}

    .empty{padding:12px;border:2px dashed #808080;background:#e0e0e0;text-align:center;color:#000}

    .hint{font-size:12px;color:#000;margin-top:4px}
    .footer{font-size:12px;color:#000;padding-top:6px;border-top:2px solid #fff;border-right-color:#404040;border-bottom-color:#404040}

    @media(max-width:640px){.card{width:100%}}
  </style>
</head>
<body>
  <div class="card">
    <h1>Connexion à Internet</h1>
    <div id="start">
      <div class="row">
        <button id="btn-create" class="primary">Créer une connexion</button>
        <button id="btn-clear" class="ghost">Supprimer toutes</button>
      </div>
      <p class="hint">Clique sur "Créer une connexion" pour afficher le formulaire de création (tout reste dans ce même fichier).</p>
    </div>

    <div id="form-wrap" class="form" style="display:none">
      <label for="conn-name">Nom de la connexion</label>
      <input id="conn-name" type="text" placeholder="ex: Connexion Free RTC" />

      <div class="grid" style="margin-top:12px">
        <div>
          <label for="phone">Numéro de téléphone</label>
          <input id="phone" type="tel" placeholder="ex: 09 72 12 34 56" />
        </div>
        <div>
          <label for="user">Nom d'utilisateur</label>
          <input id="user" type="text" placeholder="ex: mon_identifiant" />
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <div style="flex:1">
          <label for="pass">Mot de passe</label>
          <input id="pass" type="password" placeholder="mot de passe" />
        </div>
        <div style="width:120px;margin-top:22px">
          <button id="toggle-pass" class="toggle-pass">Afficher</button>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;">
        <button id="save" class="primary">Enregistrer la connexion</button>
        <button id="cancel" class="ghost">Annuler</button>
      </div>

      <p class="hint">Après enregistrement, la connexion apparaît dans la liste ci-dessous et est conservée dans la mémoire du navigateur.</p>
    </div>

    <div class="list" id="list-area">
      <!-- Liste des connexions -->
    </div>

    <div class="footer"></div>
  </div>

  <script>
    const key = 'my_saved_connections_v1';
    const btnCreate = document.getElementById('btn-create');
    const btnClear = document.getElementById('btn-clear');
    const formWrap = document.getElementById('form-wrap');
    const start = document.getElementById('start');
    const saveBtn = document.getElementById('save');
    const cancelBtn = document.getElementById('cancel');
    const listArea = document.getElementById('list-area');
    const togglePass = document.getElementById('toggle-pass');

    // --- NOUVEAU : fenêtre de connexion simulée ---
    let connTimer = null;
    let connSeconds = 0;

    function openConnectionWindow(name){
      document.title = 'Connexion à Internet';
      const icon = document.createElement('link');
      icon.rel = 'icon';
      icon.href = 'https://i.postimg.cc/1XM0nq03/145219762.png';
      document.head.appendChild(icon);

      const win = document.createElement('div');
      win.style.position='fixed';
      win.style.top='50%';
      win.style.left='50%';
      win.style.transform='translate(-50%,-50%)';
      win.style.background='#c0c0c0';
      win.style.border='2px solid #fff';
      win.style.borderRightColor='#404040';
      win.style.borderBottomColor='#404040';
      win.style.padding='14px';
      win.style.width='420px';
      win.style.zIndex='9999';
      win.innerHTML = `
        <h2 style="margin:0;background:#000080;color:white;padding:4px;font-size:15px">Connexion : ${name}</h2>
        <div id="log" style="margin-top:10px;background:#e0e0e0;padding:10px;height:120px;overflow:auto;border:2px inset #fff;font-family:monospace;font-size:13px"></div>
        <p id="timer" style="margin-top:10px;font-weight:bold">Durée : 00:00:00</p>
        <button id="stop" style="margin-top:10px">Arrêter</button>
      `;
      document.body.appendChild(win);

      const log = win.querySelector('#log');
      function write(t){ log.innerHTML += t + '<br>'; log.scrollTop = log.scrollHeight; }

      // Simulation étapes
      write('Initialisation du modem...');
      setTimeout(()=>write('Composition du numéro...'),1000);
      setTimeout(()=>write('Négociation...'),2000);
      setTimeout(()=>write('Connexion établie !'),3000);

      setTimeout(()=>{
        startTimer();
      },3000);

      win.querySelector('#stop').onclick = ()=>{
        stopTimer();
        document.body.removeChild(win);
        document.title = 'Connexion à Internet';
      };
    }

    function startTimer(){
      connSeconds = 0;
      connTimer = setInterval(()=>{
        connSeconds++;
        const h = String(Math.floor(connSeconds/3600)).padStart(2,'0');
        const m = String(Math.floor((connSeconds%3600)/60)).padStart(2,'0');
        const s = String(connSeconds%60).padStart(2,'0');
        const t = `${h}:${m}:${s}`;

        const timer = document.getElementById('timer');
        if(timer) timer.textContent = 'Durée : ' + t;
        document.title = `Connexion à Internet (${t})`;
      },1000);
    }

    function stopTimer(){ clearInterval(connTimer); connTimer=null; }

    // --- FIN NOUVEAU ---

    btnCreate.addEventListener('click', ()=>{
      formWrap.style.display = 'block';
      start.style.display = 'none';
    });

    cancelBtn.addEventListener('click', ()=>{
      formWrap.style.display = 'none';
      start.style.display = 'block';
      clearForm();
    });

    togglePass.addEventListener('click', ()=>{
      const p = document.getElementById('pass');
      if(p.type === 'password'){ p.type = 'text'; togglePass.textContent = 'Masquer'; }
      else { p.type = 'password'; togglePass.textContent = 'Afficher'; }
    });

    btnClear.addEventListener('click', ()=>{
      if(confirm('Supprimer toutes les connexions enregistrées ?')){
        localStorage.removeItem(key);
        renderList();
      }
    });

    saveBtn.addEventListener('click', ()=>{
      const name = document.getElementById('conn-name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const user = document.getElementById('user').value.trim();
      const pass = document.getElementById('pass').value;

      if(!name){ alert('Donne un nom à la connexion.'); return; }

      const conn = {id: Date.now(), name, phone, user, pass};
      const all = load();
      all.unshift(conn);
      save(all);
      renderList();
      clearForm();
      formWrap.style.display = 'none';
      start.style.display = 'block';
    });

    function load(){
      try{
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function save(arr){ localStorage.setItem(key, JSON.stringify(arr)); }
    function clearForm(){ document.getElementById('conn-name').value='';document.getElementById('phone').value='';document.getElementById('user').value='';document.getElementById('pass').value=''; }

    function renderList(){
      const arr = load();
      listArea.innerHTML = '';
      if(arr.length===0){ listArea.innerHTML = '<div class="empty">Aucune connexion enregistrée pour le moment.</div>'; return; }

      arr.forEach(item=>{
        const div = document.createElement('div'); div.className='item';
        const left = document.createElement('div');
        left.innerHTML = `<div class="meta"><strong>${escapeHtml(item.name)}</strong></div><div class="small">${escapeHtml(item.phone || '(pas de numéro)')} — ${escapeHtml(item.user || '(pas d\'identifiant)')}</div>`;
        const right = document.createElement('div'); right.className='actions';

        const connect = document.createElement('button'); connect.textContent='Se connecter';
        connect.addEventListener('click', ()=> openConnectionWindow(item.name));

        const show = document.createElement('button'); show.textContent='Afficher';
        show.addEventListener('click', ()=> alert(formatDetails(item)));

        const del = document.createElement('button'); del.textContent='Supprimer';
        del.addEventListener('click', ()=>{ if(confirm('Supprimer cette connexion ?')){ remove(item.id);} });

        right.appendChild(connect);
        right.appendChild(show);
        right.appendChild(del);
        div.appendChild(left);
        div.appendChild(right);
        listArea.appendChild(div);
      });
    }

    function remove(id){ const arr = load().filter(x=>x.id!==id); save(arr); renderList(); }

    function formatDetails(it){ return `Nom : ${it.name}
Téléphone : ${it.phone || '-'}
Utilisateur : ${it.user || '-'}
Mot de passe : ${it.pass || '-'}
`; }

    function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;'); }

    renderList();
  </script>
</body>
</html>
